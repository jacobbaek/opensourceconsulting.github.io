<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
 <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<title>Spacewalk latest Docker image 제작기</title>
<meta name="title" content="Spacewalk latest Docker image 제작기" />
<meta name="author" content="chhan"/>
<meta name="description" content="Spacewalk latest Docker image 제작기 안녕하세요? 오픈소스컨설팅 한철희 입니다. 고객사의 요청으로 Spacewalk 를 docker container 형태로 운영을 해야되는 요건이 생겨서 Image를 만들기 시작 하였습니다…… ;( Spacewalk 란? Spacewalk는 오픈 소스 Linux 시스템 관리 솔루션입니다. Red Hat Satellite 제품이 파생 된 업스트림 커뮤니티 프로젝트입니다. @Go to detail @[오픈소스컨설팅]클라우드자동화 및 운영효율화방안 쉽게 가자… docker 의 장점이 뭡니까! docker hub의 많은 Official Image 아닙니까! 열심히 Docker Image를 찾아보았습니다. 하지만… # docker search spacewalk INDEX NAME DESCRIPTION STARS OFFICIAL..."/>

<meta property="fb:app_id" content=""/>

<meta property="og:site_name" content="오픈소스컨설팅 
기술 블로그
"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="Spacewalk latest Docker image 제작기"/>
<meta property="og:description" content="Spacewalk latest Docker image 제작기 안녕하세요? 오픈소스컨설팅 한철희 입니다. 고객사의 요청으로 Spacewalk 를 docker container 형태로 운영을 해야되는 요건이 생겨서 Image를 만들기 시작 하였습니다…… ;( Spacewalk 란? Spacewalk는 오픈 소스 Linux 시스템 관리 솔루션입니다. Red Hat Satellite 제품이 파생 된 업스트림 커뮤니티 프로젝트입니다. @Go to detail @[오픈소스컨설팅]클라우드자동화 및 운영효율화방안 쉽게 가자… docker 의 장점이 뭡니까! docker hub의 많은 Official Image 아닙니까! 열심히 Docker Image를 찾아보았습니다. 하지만… # docker search spacewalk INDEX NAME DESCRIPTION STARS OFFICIAL..."/>
<meta property="og:url" content="https://tech.osci.kr/spacewalk/2019/01/07/55869620/"/>
<meta property="og:image" content=""/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="Spacewalk latest Docker image 제작기"/>
<meta name="twitter:description" content="Spacewalk latest Docker image 제작기 안녕하세요? 오픈소스컨설팅 한철희 입니다. 고객사의 요청으로 Spacewalk 를 docker container 형태로 운영을 해야되는 요건이 생겨서 Image를 만들기 시작 하였습니다…… ;( Spacewalk 란? Spacewalk는 오픈 소스 Linux 시스템 관리 솔루션입니다. Red Hat Satellite 제품이 파생 된 업스트림 커뮤니티 프로젝트입니다. @Go to detail @[오픈소스컨설팅]클라우드자동화 및 운영효율화방안 쉽게 가자… docker 의 장점이 뭡니까! docker hub의 많은 Official Image 아닙니까! 열심히 Docker Image를 찾아보았습니다. 하지만… # docker search spacewalk INDEX NAME DESCRIPTION STARS OFFICIAL..."/>
<meta name="twitter:label1" content="Written by"/>
<meta name="twitter:data1" content="chhan"/>
<meta name="twitter:image:src" content="https://tech.osci.kr/assets/images/default_blog_cover.jpg"/>
<meta name="naver-site-verification" content="11ec9086ec9292ebc8dc73f6224492f208b2007b"/>
<meta name="google-site-verification" content="Q5w5X0R32gOG-1lBhFg0UxvXRNoQX-uOSPjxPI4sXH4" />

<meta name="twitter:label2" content="Filed under"/>
<meta name="twitter:data2" content="Spacewalk"/>

<meta property="article:tag" content="Spacewalk"/>



<meta property="article:published_time" content="2019-01-07T00:00:00+09:00"/>


<meta property="article:author" content="https://tech.osci.kr/authors/chhan"/>

<link href="https://tech.osci.kr/rss/" rel="alternate" type="application/rss+xml" title="RSS"/>
<link href="/assets/favicon.png" rel="icon" type="image/png"/>
<link href="/assets/apple-touch-icon.png" rel="apple-touch-icon" type="image/png"/>
<link href="/assets/apple-touch-icon.png" rel="apple-touch-icon-precomposed" type="image/png"/>
<link href="/assets/lib/normalize.css" rel="stylesheet" type="text/css"/>
<link href="/assets/css/monokai.css" rel="stylesheet" type="text/css"/>
<link href="/assets/lib/magnific-popup.min.css" rel="stylesheet" type="text/css"/>
<link href="/assets/css/screen.css" rel="stylesheet" type="text/css"/>

</head>
<body class="post-template">

<div id="header">
    <button id="menu-toggle" type="button">
        <span class="sr-only">Toggle Navigation Menu</span>
    </button>
    <button id="search-toggle" type="button">
        <span class="sr-only">Toggle Search Form</span>
    </button>
    <a href="/" id="logo">
    </a>
    <form id="search">
        <input id="searchQueryEdit" name="q" type="search" placeholder="Search..." value="" />
    </form>

    <ul id="menu" class="nav">
        <li class=" active "><a href="/">Blog</a></li>
        <!--<li class=""><a href="/books/">Books</a></li>-->
        <li class=""><a href="/about/">About</a></li>
    </ul>
</div><!-- #header -->


<div id="wrapper">
    <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://connect.facebook.net/ko_KR/sdk.js#xfbml=1&version=v3.2&appId=1720005341592310&autoLogAppEvents=1';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="navbar" class="container">
    <h5><a id="link-back" href="/">Back to Posts</a></h5>
    
<ul id="shares">
    
    <li>
        <a id="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://tech.osci.kr/spacewalk/2019/01/07/55869620/"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <span class="sr-only">Share to Facebook</span>
        </a>
    </li>
    
    
    
</ul>

</div>

<div id="cover" class="container"
     >
    <div>
        <h1>Spacewalk latest Docker image 제작기</h1>
        <p> </p>
        <p class="right" style="opacity: 0.5">
            
                Spacewalk
                
            
        </p>
        


    </div>
</div>
<div id="content" class="container post" role="main">
    <div id="post-content">
        
        <h1 id="spacewalk-latest-docker-image-제작기">Spacewalk latest Docker image 제작기</h1>
<hr />

<p>안녕하세요? 오픈소스컨설팅 한철희 입니다. <br />
고객사의 요청으로 Spacewalk 를 docker container 형태로 운영을 해야되는 요건이 생겨서 <br />
Image를 만들기 시작 하였습니다…… ;(</p>

<h1 id="spacewalk-란">Spacewalk 란?</h1>
<hr />
<p>Spacewalk는 오픈 소스 Linux 시스템 관리 솔루션입니다. <br />
Red Hat Satellite 제품이 파생 된 업스트림 커뮤니티 프로젝트입니다.</p>

<center><img src="https://chhanz.github.io/assets/images/post/2019-01-07-spacewalkdocker/1.png" height="550" /> <br />
<a href="https://spacewalkproject.github.io/index.html">@Go to detail</a>  <br />
<a href="https://www.slideshare.net/ienvyou/ss-31321783">@[오픈소스컨설팅]클라우드자동화 및 운영효율화방안</a><br /> </center>

<h1 id="쉽게-가자">쉽게 가자…</h1>
<hr />
<p>docker 의 장점이 뭡니까! <br />
docker hub의 많은 Official Image 아닙니까!</p>

<p>열심히 Docker Image를 찾아보았습니다. <br />
하지만…</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># docker search spacewalk
INDEX       NAME                                            DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
docker.io   docker.io/bashell/spacewalk                     Spacewalk Docker Image                          7                    [OK]
docker.io   docker.io/ruo91/spacewalk                       Spacewalk is an open source Linux systems ...   4                    [OK]
docker.io   docker.io/pajinek/docker-spacewalk              Spacewalk in Docker (without systemd)           3                    [OK]
docker.io   docker.io/egonzalez90/spacewalk                 Spacewalk docker image                          1                    [OK]
</code></pre></div></div>

<p>OFFICIAL 은 없고, 그나마 STARS 는 7개 뿐이고…  <br />
내가 만들어야겠다… ;)  <br />
이렇게 시작 되었습니다.</p>

<h1 id="docker-image-를-만들어보자">Docker Image 를 만들어보자!</h1>
<hr />

<p>먼저 참고할 Dockerfile 은 docker hub 에서 가져왔습니다.</p>
<blockquote>
  <p>https://bitbucket.org/bashell-com/spacewalk</p>
</blockquote>

<p>Dockerfile 은 아래와 같이 수정하였습니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Dockerfile - Spacewalk
#
# - Build
#
# docker build --rm -t spacewalk .
#
# - Run
# docker run --privileged=true -d --name="spacewalk" -p 80:80 -p 443:443 spacewalk

# 1. Base images
FROM     centos:6
MAINTAINER chhanz &lt;chhan@osci.kr&gt;

# 2. Set the environment variable
WORKDIR /opt

# 3. Add the epel, spacewalk, jpackage, supervisord
ADD conf/group_spacewalkproject-epel6-addons-epel-6.repo /etc/yum.repos.d/epel6-addons-epel-6.repo
ADD conf/group_spacewalkproject-java-packages-epel-7.repo /etc/yum.repos.d/java-packages-epel-7.repo
RUN yum install -y epel-release \
 &amp;&amp; rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-6-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el6.noarch.rpm \
 &amp;&amp; yum check-update ; yum upgrade -y \
 &amp;&amp; yum install -y spacewalk-setup-postgresql spacewalk-postgresql tomcat-native python-setuptools python-pip \
 &amp;&amp; yum clean all \
 &amp;&amp; pip install supervisor &amp;&amp; pip install --upgrade meld3==0.6.10 &amp;&amp; mkdir /etc/supervisord.d \
 &amp;&amp; rm -rf /root/.cache \
 &amp;&amp; cat /usr/share/zoneinfo/Asia/Seoul &gt; /etc/localtime

# 4. Install supervisord config
ADD conf/supervisord.conf /etc/supervisord.d/supervisord.conf

# 5. Install spacewalk initial and running scripts
ADD conf/answer.txt   /opt/answer.txt
ADD conf/spacewalk.sh /opt/spacewalk.sh

# 6. Start supervisord
CMD ["/usr/bin/supervisord", "-c", "/etc/supervisord.d/supervisord.conf"]

# System Log
VOLUME /var/log

# PostgreSQL Data
VOLUME /var/lib/pgsql/data

# RPM repository
VOLUME /var/satellite

# Bootstrap directory
VOLUME /var/www/html/pub

# Port
EXPOSE 80 443
</code></pre></div></div>

<p>수정된 내용은 아래와 같습니다.</p>
<blockquote>
  <ol>
    <li>Update Spacewalk (Spacewalk 2.6 &gt; Spacewalk 2.8)</li>
    <li>Spacewalk 2.8 Repository 로 변경</li>
    <li>spacewalk-setup 에 필요한 Answer file 을 최신버전의 요건에 맞게 수정하였습니다.</li>
    <li>Container  로 실행할때, Spacewalk 가 정상적으로 시작되는지 확인이 가능하도록 내부 Script 를 수정하였습니다.</li>
    <li>supervisord 를 통해, Spacewalk 를 시작하는데 해당 Log 를 debug 수준으로 설정해서 상태를 확인하는 것이 더욱 쉽게 만들었습니다.</li>
    <li>localtime 을 Asia/Seoul 으로 설정 하였습니다.</li>
  </ol>
</blockquote>

<p>위와 같이 수정한 Dockerfile 를 Build 합니다.</p>

<h1 id="build">Build</h1>
<hr />

<p>Dockerfile 및 image 에 추가될 file 이 있는 Directory 에서 Build 를 진행합니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># docker build --rm -t spacewalk .
</code></pre></div></div>

<p>많은 시간이 소요되면서 Build 가 진행 됩니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
spacewalk           latest             f0e26b8230ad        13 days ago         1.04 GB
</code></pre></div></div>

<p>위와 같이 Build 가 완료 되었습니다.</p>

<h1 id="run">Run</h1>
<hr />

<p>Build 가 된 이미지를 실행합니다. <br />
먼저 Container 가 종료되고, 제거가 되더라도 Spacewalk 데이터를 보존 할 수 있게 Volume 으로 사용될 경로를 생성합니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir -p /data/var/lib/pgsql/data
mkdir -p /data/var/satellite
mkdir -p /data/var/www/html/pub
mkdir -p /data/var/log/tomcat6
mkdir -p /data/var/log/httpd
mkdir -p /data/var/log/cobbler

chown 26:26 /data/var/lib/pgsql/data
chmod 777 -R /data/var
</code></pre></div></div>

<p>Volume 생성이 다 되었다면,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># docker run --privileged=true -d --name="spacewalk" -p 80:80 -p 443:443 -v /data/var/log:/var/log -v /data/var/lib/pgsql/data:/var/lib/pgsql/data -v /data/var/satellite:/var/satellite -v /data/var/www/html/pub:/var/www/html/pub spacewalk
</code></pre></div></div>

<p>위 명령으로 Container 를 시작합니다.</p>

<p>https://(Docker Host IP)  로 접속합니다.</p>

<p>아래와 같이 Spacewalk 화면을 확인 할 수 있습니다.</p>

<p><img src="https://chhanz.github.io/assets/images/post/2019-01-07-spacewalkdocker/0.png" height="400" /></p>

<h1 id="마치며">마치며</h1>
<hr />

<p>위와 같이 나만의 특별한 Docker Image 를 생성 할 수 있었습니다.  <br />
해당 Dockerfile 및 기타 필요한 file, 쉽게 Spacewalk 를 운영 할 수 있도록 만든 Script 들을 github 에 올려놨습니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># git clone https://github.com/chhanz/spacewalk-docker-img.git
</code></pre></div></div>

<p>앞으로도 Opensource Software 를 손쉽게 사용 할 수 있도록 노력 하겠습니다.</p>

<p>감사합니다.</p>

<h2 id="참고-자료">참고 자료</h2>
<hr />
<ul>
  <li>Base Dockerfile : <a href="https://bitbucket.org/bashell-com/spacewalk">https://bitbucket.org/bashell-com/spacewalk</a></li>
  <li>Spacewalk Document : <a href="https://spacewalkproject.github.io/documentation.html">https://spacewalkproject.github.io/documentation.html</a></li>
  <li>chhanz github : <a href="https://github.com/chhanz/spacewalk-docker-img">https://github.com/chhanz/spacewalk-docker-img</a></li>
</ul>

        <div class="fb-like" data-href="https://tech.osci.kr/spacewalk/2019/01/07/55869620/"  data-width="300px" data-layout="standard" data-action="like" data-size="small" data-show-faces="true" data-share="true"></div>
        <div class="fb-comments" data-href="https://tech.osci.kr/spacewalk/2019/01/07/55869620/" data-width="100%" data-numposts="5"></div>
    </div>

    <div id="post-footer">
        
        <a id="post-author" href="/authors/chhan/">
            <div id="author-image" style="background-image:url(/files/authors/chhan.png);">
                <span class="sr-only">chhan's profile image</span>
            </div>
            <p id="author-name">chhan</p>
        </a>
        <p id="post-date">2019-01-07</p>
        <a id="post-more" href="/authors/chhan/">
            <span>Read more posts by this author</span>
        </a>
    </div>
</div>

<div id="post-links" class="container">
    
    
        <div id="post-prev"
             style="background-image: url(/assets/images/55869620/0.png);">
            <div>
                <h3><a href="/2019/01/07/55869620/">Spacewalk latest Docker image 제작기</a></h3>
                <p>YOU MIGHT ENJOY</p>
            </div>
        </div>
    
    
    
        <div id="post-next"
             style="background-image: url(/assets/images/58035473/0.png);">
            <div>
                <h3><a href="/2019/01/31/58035473/">2019년 1월 아틀라시안 업데이트 소식</a></h3>
                <p>NEXT POST</p>
            </div>
        </div>
    
</div>

<div id="lightbox">
    <div id="lightbox-image"></div>
</div>


    <div class="clearfix"></div>

    <a href="#" id="back-to-top"></a>
</div>

<div id="footer" class="container-fluid">
    <ul id="links">
        
        <li>
            <a id="link-github" href="http://github.com/opensourceconsulting" target="_blank">
                <span class="sr-only">github</span>
            </a>
        </li>
        
        
        <li>
            <a id="link-facebook" href="http://facebook.com/osckorea" target="_blank">
                <span class="sr-only">facebook</span>
            </a>
        </li>
        
        
        <li>
            <a id="link-rss" href="/rss" target="_blank">
                <span class="sr-only">rss</span>
            </a>
        </li>
    </ul>
    <p id="copyright">
        <a href="https://tech.osci.kr">&copy;2018 OpenSourceConsulting</a>
        All rights reserved.
    </p>
</div><!--#footer-->


<script src="/assets/lib/jquery-1.12.0.min.js"></script>
<script src="/assets/lib/jquery.magnific-popup.min.js"></script>
<script src="/assets/js/index.js"></script>


<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-39977834-4', 'auto');
    ga('send', 'pageview');
</script>





    
    <!-- <script>
    window.fbAsyncInit = function() {
        FB.init({
            appId      : '',
            xfbml      : true,
            version    : 'v2.8'
        });
        FB.Canvas.getPageInfo(
            function(info) {
                alert('Width: ' + info.clientWidth + ' Height: ' + info.clientHeight);
            }
        );
        FB.AppEvents.logPageView();
    };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/ko_KR/sdk.js#xfbml=1&version=v2.8";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script> -->

<!--
<script>
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/ko_KR/sdk.js#xfbml=1&version=v2.8";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>
-->

    

    

    

</body>
</html>
